# 🧋 奶茶小程序开发任务清单 (TODO List)

**项目**: 智能奶茶档口顾客端小程序
**技术栈**: 原生微信小程序 + TypeScript + MobX + TDesign
**冲刺周期**: 2025.11.20 - 2025.12.05 (15天)
**当前日期**: 2025.11.25
**当前阶段**: M1基建完成 → M2业务开发期

---

## 📊 里程碑概览

| 里程碑 | 日期 | 状态 | 验收标准 |
|-------|------|------|---------|
| M0: 项目启动 | 11.20 | ✅ 完成 | Git仓初始化、需求定稿 |
| M1: 基建完成 | 11.21-11.25 | ✅ 完成 | 网络层/状态管理/UI组件已就绪，游客购物车已实现 |
| M2: 业务开发 | 11.26-11.30 | ⏳ 50%完成 | ✅ 菜单/规格选择已完成 ⏳ 结算页待开发 |
| M3: 支付联调 | 12.01-12.03 | ⏳ 待开始 | 真机可唤起支付、状态更新正确、P0=0 |
| M4: Dev Freeze | 12.04-12.05 | ⏳ 待开始 | 提测包、Checklist全绿、回滚演练通过 |

---

## 🔥 P0 任务 (阻断性，必须完成)

### 1. 基建与公共层 【11.20-11.22】 ✅ 已完成

#### 1.1 网络层封装 ✅
- [x] **创建 `miniprogram/utils/request.ts`**
  - [x] 封装 `wx.request` 拦截器
  - [x] Token 自动注入 (从 Storage 读取)
  - [x] `X-Idempotency-Key` 生成逻辑 (UUID v4)
  - [x] 统一错误码处理与 Toast 提示
  - [x] 超时配置 (默认 10s)
  - [x] 环境切换逻辑 (dev/staging/prod)
  
- [x] **创建 `miniprogram/config/index.ts`**
  - [x] dev 环境配置 (`http://localhost:8000`)
  - [x] prod 环境配置 (`https://guajunyan.top`)
  - [x] staging 环境配置 (待定)
  - [x] 导出当前环境判断函数

#### 1.2 状态管理 ✅
- [x] **使用 MobX 状态管理方案**
  - [x] 已安装依赖: `mobx-miniprogram` + `mobx-miniprogram-bindings`
  
- [x] **创建 `miniprogram/stores/index.ts`**
  - [x] 用户信息状态 (token, userInfo)
  - [x] 登录/登出方法
  - [x] 持久化到 Storage
  
- [x] **创建 `miniprogram/stores/shopStore.ts`**
  - [x] 商家信息 (营业状态、配送范围、联系方式)
  - [x] 菜单数据缓存
  
- [x] **创建 `miniprogram/stores/cartStore.ts`**
  - [x] 游客/用户双模式购物车
  - [x] 添加/删除/更新商品
  - [x] 清空购物车
  - [x] 登录后合并游客购物车
  - [x] 持久化到 Storage
  - [x] 计算商品总数量

#### 1.3 UI 组件库集成 ✅
- [x] **安装 TDesign**
  - [x] `npm install tdesign-miniprogram`
  - [x] 配置 npm 构建
  - [x] 主题变量配置 (适老化主题支持)
  
- [x] **创建通用组件**
  - [x] `miniprogram/components/product-card/` (商品卡片)
  - [x] `miniprogram/components/navigation-bar/` (自定义导航栏)
  - [x] `miniprogram/custom-tab-bar/` (自定义 TabBar)

#### 1.4 埋点框架 ✅ 已完成 (2025.11.26)
- [x] **创建 `typings/analytics.d.ts`**
  - [x] 完整的事件类型定义 (AnalyticsEvent, BatchEventsRequest)
  - [x] 各类业务事件 payload 接口 (ProductView, AddToCart, OrderCreate, Payment 等)
  - [x] 页面访问、用户属性更新等基础事件类型
  
- [x] **创建 `miniprogram/utils/analytics.ts`**
  - [x] 事件上报函数 (track/page/user)
  - [x] 数据脱敏 (手机号仅后4位)
  - [x] 批量上报与本地缓存 (最多100条队列)
  - [x] 防抖上报 (500ms，批量最多10条)
  - [x] 幂等性支持 (UUID v4 去重)
  - [x] 自动注入公共字段 (timestamp, user_id, session_id)
  - [x] Payload 大小校验 (最大 8KB)
  
- [x] **创建 `miniprogram/api/analytics.ts`**
  - [x] 后端接口对接 (POST /api/v1/analytics/events)
  - [x] 游客模式支持 (X-Session-Id 请求头)
  - [x] 静默失败处理 (不影响业务流程)
  - [x] 健康检查接口 (GET /api/v1/analytics/health)
  
- [x] **创建 `miniprogram/utils/page-analytics.ts`**
  - [x] 页面生命周期混入 (pageAnalytics)
  - [x] 自动记录页面访问、停留时长、页面离开
  - [x] 高阶函数封装 (createPageWithAnalytics)
  - [x] 分享事件自动埋点
  
- [x] **App 级别集成**
  - [x] app.ts 初始化埋点系统
  - [x] 应用显示/隐藏事件记录
  - [x] 错误自动上报
  - [x] 退出前强制上报
  
- [x] **使用文档**
  - [x] 创建 `docs/analytics-usage-guide.md` 完整使用指南
  - [x] 涵盖页面访问、商品、购物车、订单、支付等所有场景
  - [x] 提供完整代码示例和最佳实践
  
- [ ] **集成监控平台 (可选，P2优先级)**
  - [ ] 小程序原生性能监控
  - [ ] 第三方监控平台集成

---

### 2. 登录与授权 【11.21-11.22】 ✅

**策略说明**：采用"延迟登录"策略，用户可无需登录直接浏览菜单、加购物车，仅在结算/支付时才要求登录。

#### 2.1 认证服务 ✅
- [x] **使用原生小程序登录流程**
  - [x] `wx.login()` - 获取微信 code
  - [x] 调用后端换取 token
  - [x] `wx.getUserProfile()` - 获取用户信息（头像昵称）
  - [x] 游客模式支持 - 无需登录即可浏览和加购
  - [x] 登录拦截 - 结算/支付/订单页面需登录
  - [x] 登录后合并游客购物车
  
- [x] **游客购物车实现**
  - [x] 使用独立的 storage key 存储游客购物车
  - [x] 用户登录后自动合并到用户购物车
  - [x] 合并策略：相同商品规格累加数量
  
- [x] **App 启动流程 `miniprogram/app.ts`**
  - [x] 初始化 MobX stores
  - [x] 尝试静默登录（不阻塞）
  - [x] 允许用户直接进入菜单页浏览
  - [x] 登录检查延迟到需要时（结算/支付）

---

### 3. 菜单页开发 【11.22-11.25】 ✅ 已完成

#### 3.1 页面结构 ✅
- [x] **创建 `miniprogram/pages/menu/menu.wxml`**
  - [x] 顶部自定义导航栏 (搜索框)
  - [x] 左右联动布局 (scroll-view 双联动)
  - [x] 底部吸附栏 (购物车入口 + 去结算按钮)
  - [x] 店铺详情弹窗
  - [x] 店铺状态展示 (营业中/休息中)
  
- [x] **分类列表实现**
  - [x] 分类列表渲染
  - [x] 选中高亮样式
  - [x] 点击滚动到对应商品区域
  - [x] 下拉刷新功能
  
- [x] **使用 `miniprogram/components/product-card/`**
  - [x] 商品图片 (1:1 缩略图，WebP 格式)
  - [x] 标题、描述、价格
  - [x] 售罄角标与置灰
  - [x] 加购 "+" 按钮
  - [x] 点击打开规格弹层

#### 3.2 数据加载 ✅
- [x] **创建 `miniprogram/api/menu.ts`**
  - [x] `getMenuData()` - 获取菜单与分类
  - [x] 数据缓存策略 (使用 MobX menuStore)
  - [x] 店铺信息加载
  
- [x] **骨架屏加载**
  - [x] 使用自定义骨架屏
  - [x] 商品列表骨架屏 (图片方块 + 两行文字)
  - [x] 侧边栏骨架屏
  - [x] 至少展示 300ms

#### 3.3 搜索功能 🚧
- [x] **搜索框 UI 已实现**
  - [x] 使用 TDesign search 组件
  - [x] 清空按钮
  - [x] 占位符文案
  
- [ ] **搜索功能待完善** (优先级 P2)
  - [ ] 实时搜索 (300ms 防抖)
  - [ ] 搜索结果高亮
  - [ ] 无结果空态展示

---

### 4. 规格弹层开发 【11.22-11.25】 ✅ 已完成

#### 4.1 弹层组件 ✅
- [x] **在菜单页实现规格选择**
  - [x] 使用 TDesign t-popup 组件
  - [x] 底部 Popup (高度 70-80% 屏幕)
  - [x] 商品信息头部 (图片、标题、实时价格)
  - [x] 规格选项渲染
  - [x] 使用 TDesign t-stepper 数量控件
  - [x] 底部操作按钮 (加入购物车 / 立即购买)
  - [x] 加载骨架屏效果
  
- [x] **规格选项实现**
  - [x] 单选规格 (温度、甜度、冰度)
  - [x] 多选规格 (加料，最多2种)
  - [x] 售罄选项置灰
  - [x] 价格增量显示 `+¥x`
  - [x] 规格选中状态管理

#### 4.2 业务逻辑 ✅
- [x] **默认规格选中**
  - [x] 智能默认规格策略
  - [x] 默认选中第一个可用规格
  - [x] 支持热饮/冰饮切换
  
- [x] **热饮处理**
  - [x] 温度选择 (冰饮/热饮)
  - [x] 热饮自动隐藏冰度选项
  
- [x] **加料限制**
  - [x] 最多选择 2 种加料
  - [x] 每种加料数量固定为 1
  - [x] 超出限制时 Toast 提示
  - [x] 配置化规格行为 (GROUP_BEHAVIOR_OVERRIDES)
  
- [x] **实时价格计算**
  - [x] 基础价 + 规格价差 + 加料价
  - [x] 数量 × 单价
  - [x] 实时更新头部显示
  - [x] 价格明细展示

#### 4.3 加入购物车 ✅
- [x] **数据结构设计**
  ```ts
  interface CartItem {
    product_id: number;
    product_name: string;
    quantity: number;
    base_price: number;
    selected_specs: Array<{
      group_id: number;
      group_name: string;
      option_id: number;
      option_name: string;
      price_modifier: number;
    }>;
  }
  ```
  
- [x] **添加逻辑**
  - [x] 必选规格校验
  - [x] 检查是否已存在相同规格商品
  - [x] 存在则累加数量，不存在则新增
  - [x] 更新 CartStore
  - [x] Toast 提示 "已加入购物车" (1.5s)
  - [x] 关闭弹层
  - [x] 立即购买功能 (清空购物车后添加并跳转结算)

---

### 5. 购物车功能 【11.23-11.25】

#### 5.1 购物车页面 (已有基础实现)
- [x] **购物车基础功能**
  - [x] 商品列表展示
  - [x] 增减数量控件 (使用 TDesign stepper)
  - [x] 游客/用户双模式购物车
  - [x] 持久化存储
  
- [ ] **待完善功能**
  - [ ] 删除商品 (左滑或长按)
  - [ ] 失效商品置灰 (库存不足/下架)
  - [ ] 清空购物车按钮
  - [ ] 底部总价与结算按钮优化
  - [ ] 空态处理 - 使用 TDesign empty 组件
  - [ ] 文案: "肚子在叫?来一杯吧~"
  - [ ] "去逛逛" 按钮返回菜单页

#### 5.2 底部吸附栏 (菜单页) ✅
- [x] **在菜单页添加底部栏**
  - [x] 购物车图标 + 数量徽标 (使用 TDesign badge)
  - [x] 总价显示 (从 cartStore 计算)
  - [x] "去结算" 按钮
  - [x] 配送方式切换 (自提/外送)
  - [x] 配送费用提示

---

### 6. 结算页开发 【11.27-11.29】 ⚠️ 重头戏

#### 6.1 页面结构
- [ ] **创建 `miniprogram/pages/checkout/`**
  - [ ] 登录检查 - 未登录用户弹出授权
  - [ ] 顶部 Tabs (自提 / 外送) - 使用 TDesign tabs
  - [ ] 自提卡片 (预计时间)
  - [ ] 外送卡片 (地址选择 / 表单)
  - [ ] 商品明细折叠面板 - 使用 TDesign collapse
  - [ ] 优惠券选择入口
  - [ ] 集点进度展示
  - [ ] 费用明细 (小计/优惠/运费/实付)
  - [ ] 底部提交按钮

#### 6.2 地址选择 (外送)
- [ ] **地址选择实现**
  - [ ] 使用 `wx.chooseLocation` 选择地址
  - [ ] 手动输入表单 (收货人/手机号/详细地址)
  - [ ] 表单校验 (必填项、手机号格式)
  - [ ] 使用 TDesign input/cell 组件
  
- [ ] **配送范围校验**
  - [ ] 创建 `miniprogram/api/shop.ts`
  - [ ] `checkDeliveryRange(lat, lng)` - 调用 `POST /shop/delivery/check`
  - [ ] 超过 10km 使用 TDesign dialog 提示并阻断
  - [ ] 引导切换为自提

#### 6.3 算价核心逻辑
- [ ] **使用现有 order API**
  - [ ] `previewOrder(params)` - 调用 `POST /orders/preview`
  - [ ] 防抖处理 (≥200ms)
  - [ ] 使用 TDesign dialog 处理错误:
    - [ ] `PRICE_CHANGED` - 二次确认对话框
    - [ ] `COUPON_INVALID` - 清除券并重算
    - [ ] `INVENTORY_SHORTAGE` - 提示并移除失效商品
  
- [ ] **触发时机**
  - [ ] 进入结算页
  - [ ] 切换自提/外送
  - [ ] 选择/取消优惠券
  - [ ] 修改商品数量 (购物车)

#### 6.4 优惠券面板
- [ ] **创建 `src/pages/checkout/components/CouponPanel.tsx`**
  - [ ] 可用券列表 (按即将过期排序)
  - [ ] 不可用券列表 (显示原因: 未满足门槛/已过期)
  - [ ] 选中状态高亮
  - [ ] "不使用优惠券" 选项
  
- [ ] **创建 `src/services/coupon.ts`**
  - [ ] `getMyCoupons()` - 获取用户优惠券列表

#### 6.5 集点展示
- [ ] **创建 `src/pages/checkout/components/StampCard.tsx`**
  - [ ] 当前进度显示 "X/10"
  - [ ] 进度条 (10连杯图标)
  - [ ] 提示文案: "下单后可累计 1 杯"
  - [ ] **不提供兑换按钮** (MVP: 后台人工核销)

#### 6.6 提交订单
- [ ] **订单创建**
  - [ ] `createOrder(params)` - 调用 `POST /api/v1/orders`
  - [ ] 生成幂等键 `X-Idempotency-Key`
  - [ ] 成功返回 `order_id`
  
- [ ] **跳转支付**
  - [ ] 跳转到支付页 `/pages/payment/index`
  - [ ] 传递 `order_id`

---

### 7. 支付流程 【12.01-12.02】

#### 7.1 支付页面
- [ ] **创建支付页面 (或在订单详情中处理)**
  - [ ] 订单信息展示
  - [ ] 支付倒计时 (15分钟)
  - [ ] "立即支付" 按钮
  - [ ] "取消订单" 按钮
  
- [ ] **支付接口**
  - [ ] `getPayParams(orderId)` - 调用 `POST /orders/{id}/pay/native`
  - [ ] `checkPayStatus(orderId)` - 轮询支付状态
  
- [ ] **微信支付调起**
  - [ ] `wx.requestPayment(params)`
  - [ ] 成功回调 → 跳转订单详情
  - [ ] 失败回调 → 使用 TDesign toast 提示并保留支付页
  - [ ] 取消回调 → 返回订单列表

#### 7.2 支付结果处理
- [ ] **支付成功**
  - [ ] 跳转订单详情页
  - [ ] 展示取餐码 (自提) 或 配送信息 (外送)
  - [ ] 埋点上报 `pay_success`
  
- [ ] **支付失败**
  - [ ] Toast 提示失败原因
  - [ ] 保留在支付页可重试
  - [ ] 埋点上报 `pay_fail`
  
- [ ] **超时取消**
  - [ ] 15分钟后订单自动取消
  - [ ] 前端倒计时归零后更新状态
  - [ ] 跳转订单列表

---

### 8. 订单管理 【11.29-11.30】

#### 8.1 订单列表 (已有基础实现)
- [x] **订单列表基础功能**
  - [x] 已创建 `miniprogram/pages/order-list/`
  - [x] 订单卡片展示
  
- [ ] **待完善功能**
  - [ ] Tabs (全部/待支付/制作中/已完成) - 使用 TDesign tabs
  - [ ] 下拉刷新 - 使用 scroll-view 的 refresher
  - [ ] 上拉加载更多
  - [ ] 空态展示 - 使用 TDesign empty
  - [ ] 取消订单功能
  
- [x] **API 已创建**
  - [x] `miniprogram/api/order.ts` 已存在

#### 8.2 订单详情
- [ ] **完善订单详情页**
  - [ ] 状态步进条 - 使用 TDesign steps
  - [ ] 取餐码大字号展示 (自提)
  - [ ] 配送信息与预计送达 (外送)
  - [ ] 商品明细
  - [ ] 金额明细
  - [ ] 联系商家按钮 - 使用 `wx.makePhoneCall`

---

### 9. 个人中心 【11.30-12.01】

#### 9.1 我的页面 (已有基础实现)
- [x] **已创建 `miniprogram/pages/profile/`**
  - [x] 基础页面结构
  
- [ ] **待完善功能**
  - [ ] 用户信息卡片 (头像/昵称/手机号) - 使用 TDesign cell
  - [ ] 集点卡 (当前进度 X/10)
  - [ ] 我的订单入口
  - [ ] 优惠券入口
  - [ ] 适老化主题切换 (已支持)
  - [ ] 关于与隐私
  - [ ] 客服电话 - 使用 `wx.makePhoneCall`
  
- [ ] **用户 API**
  - [ ] `getUserInfo()` - 获取用户信息
  - [ ] `getStampProgress()` - 获取集点进度

#### 9.2 优惠券列表
- [ ] **创建优惠券页面**
  - [ ] Tabs (可用/已使用/已过期) - 使用 TDesign tabs
  - [ ] 优惠券卡片 - 使用 TDesign coupon
  - [ ] 使用规则说明

---

## ⚡ P1 任务 (重要但不阻断)

### 10. 性能优化 【12.02-12.03】

- [ ] **图片优化**
  - [ ] 使用 WebP 格式
  - [ ] 缩略图 w≈200，详情图 w≈600
  - [ ] 使用 `<image>` 组件的懒加载模式
  - [ ] 失败占位图
  
- [ ] **代码分包**
  - [ ] 配置 `app.json` subPackages
  - [ ] 主包: index/菜单
  - [ ] 分包1: 订单相关页面
  - [ ] 分包2: 个人中心相关
  
- [ ] **首屏优化**
  - [ ] 预渲染骨架屏
  - [ ] 关键资源预加载
  - [ ] 移除不必要的同步操作
  
- [ ] **请求优化**
  - [ ] 接口数据缓存 (SWR)
  - [ ] 防抖与节流
  - [ ] 并行请求合并

### 11. 错误处理与监控 【11.28】

- [ ] **全局错误捕获**
  - [ ] `App.onError` 监听
  - [ ] `App.onPageNotFound` 处理
  - [ ] 友好错误页面
  
- [ ] **监控集成 (可选)**
  - [ ] 小程序性能监控
  - [ ] 错误上报配置
  - [ ] 数据脱敏
  
- [ ] **埋点完善**
  - [ ] 页面访问 PV/UV
  - [ ] 关键操作漏斗 (浏览→加购→下单→支付)
  - [ ] 接口性能监控 (P95/P99)
  - [ ] 异常事件上报

### 12. 用户体验优化 【11.28】

- [ ] **加载状态**
  - [ ] 按钮 loading 态 - 使用 TDesign button loading
  - [ ] 页面 loading 遮罩 - 使用 TDesign loading
  - [ ] 骨架屏优化 - 使用 TDesign skeleton
  
- [ ] **反馈提示**
  - [ ] 使用 TDesign toast 统一样式与时长
  - [ ] 使用 TDesign dialog 确认框
  - [ ] 操作成功/失败提示
  
- [ ] **交互细节**
  - [ ] 按钮防抖 (≥1.5s)
  - [ ] 表单校验提示
  - [ ] 滚动锚点定位
  - [ ] 返回顶部按钮

---

## 🔧 P2 任务 (Nice to Have)

### 13. 高级功能 【时间允许时】

- [ ] **搜索历史**
  - [ ] 本地存储搜索记录
  - [ ] 热门搜索推荐
  - [ ] 清空历史
  
- [ ] **商品收藏**
  - [ ] 收藏/取消收藏
  - [ ] 我的收藏列表
  
- [ ] **订单评价**
  - [ ] 评分与评论
  - [ ] 上传图片
  
- [ ] **分享功能**
  - [ ] 商品分享
  - [ ] 优惠券分享

### 14. 多端适配 【未来迭代】

- [ ] H5 适配
- [ ] 支付宝小程序适配
- [ ] 字节跳动小程序适配

---

## 📋 配置与资质 【负责人: 小菊】

### 15. 环境配置 【已完成】

- [x] **配置文件**
  - [x] `miniprogram/config/index.ts` - 环境配置
  - [x] `project.config.json` - 项目配置
  - [x] `project.private.config.json` - 本地私有配置
  
- [x] **环境配置**
  - [x] dev 环境: `http://127.0.0.1:xxxx`
  - [x] prod 环境: `https://guajunyan.top`
  - [x] AppID: `wx82600bad5aeb6bd6`
  
- [ ] **域名配置**
  - [ ] 在微信公众平台配置合法域名白名单

### 16. 微信小程序配置 【11.20-11.25】

- [ ] **申请小程序 APPID** (负责人: 小菊)
- [ ] **配置服务器域名白名单**
  - [ ] `https://guajunyan.top`
  - [ ] WebSocket (如需要)
  
- [ ] **申请微信支付商户号** (DDL: 11.25)
  - [ ] 提交资质审核
  - [ ] 配置支付密钥
  - [ ] 下载支付证书
  
- [ ] **申请腾讯地图 Key**
  - [ ] 申请开发者账号
  - [ ] 创建应用获取 Key
  - [ ] 配置额度与白名单

### 17. 法律与合规 【11.22-11.23】

- [ ] **编写隐私政策 `docs/privacy.md`**
  - [ ] 收集的信息类型
  - [ ] 使用目的
  - [ ] 第三方共享
  - [ ] 用户权利
  - [ ] 联系方式
  
- [ ] **客服电话确认**
  - [ ] 提供给后端配置接口
  - [ ] 前端读取并展示
  
- [ ] **业务类目与权限说明**
  - [ ] 准备提审资料
  - [ ] 权限用途说明文档

---

## 🧪 测试与质量保证 【11.29-11.30】

### 18. 真机测试 【11.29】

- [ ] **设备矩阵测试**
  - [ ] iOS 13 (iPhone 8)
  - [ ] iOS 15 (iPhone 12)
  - [ ] iOS 17 (iPhone 14)
  - [ ] Android 10 (华为)
  - [ ] Android 12 (小米)
  - [ ] Android 14 (OPPO)
  
- [ ] **弱网测试**
  - [ ] 3G 网络
  - [ ] 200ms+ 抖动
  - [ ] 离线状态提示
  
- [ ] **兼容性测试**
  - [ ] 微信基础库 ≥ 2.32
  - [ ] 不同屏幕尺寸
  - [ ] 横竖屏切换

### 19. 功能测试 【11.29】

- [ ] **E2E 核心用例**
  - [ ] 自提 Happy Path
  - [ ] 外送 Happy Path
  - [ ] 超距阻断
  - [ ] 售罄处理
  - [ ] 价格变更二次确认
  - [ ] 优惠券失效
  - [ ] 超时未付自动取消
  
- [ ] **异常流程测试**
  - [ ] 网络异常
  - [ ] 接口 500
  - [ ] 支付失败
  - [ ] 库存不足
  - [ ] 优惠券不可用

### 20. 性能测试 【11.29】

- [ ] **关键指标验收**
  - [ ] 首屏 LCP < 1.5s (4G)
  - [ ] 接口 P95 < 800ms
  - [ ] 支付成功率 ≥ 98%
  - [ ] JS 错误率 < 0.3%
  
- [ ] **体验评分**
  - [ ] 微信开发者工具评分 ≥ 80
  - [ ] Lighthouse 性能评分
  
- [ ] **包体大小**
  - [ ] 主包 < 2MB
  - [ ] 总包 < 20MB

### 21. Bug 修复 【11.29-11.30】

- [ ] **P0 Bug (阻断上线)**
  - [ ] 白屏/崩溃
  - [ ] 无法下单
  - [ ] 支付失败
  
- [ ] **P1 Bug (影响体验)**
  - [ ] UI 还原度低
  - [ ] 交互卡顿
  - [ ] 错误提示不友好

---

## 📦 发布与上线 【11.30】

### 22. 发布准备

- [ ] **提审资料准备**
  - [ ] 小程序介绍与描述
  - [ ] 类目资质证明
  - [ ] 客服电话
  - [ ] 隐私政策链接
  - [ ] 体验版账号与密码
  - [ ] 审核视频/截图
  
- [ ] **版本管理**
  - [ ] 版本号: v1.0.0
  - [ ] 更新日志
  - [ ] Git Tag 打标签
  
- [ ] **回滚演练**
  - [ ] 准备上一稳定版包
  - [ ] 回滚 SOP 文档
  - [ ] 目标 10 分钟内恢复

### 23. 上线 Checklist

- [ ] 服务器域名白名单已配置
- [ ] HTTPS 证书有效
- [ ] 支付商户号配置正确
- [ ] 地图 Key 可用
- [ ] 隐私政策可访问
- [ ] 客服电话已配置
- [ ] 体验评分 ≥ 80
- [ ] P0 Bug = 0
- [ ] 真机测试通过
- [ ] 性能指标达标
- [ ] 埋点正常上报
- [ ] Sentry 监控正常
- [ ] 灰度开关可用
- [ ] 回滚演练通过

### 24. 上线后监控

- [ ] **实时监控**
  - [ ] JS 错误率
  - [ ] 接口成功率
  - [ ] 支付成功率
  - [ ] 崩溃率
  
- [ ] **告警配置**
  - [ ] preview P95 > 800ms (连续5分钟)
  - [ ] 支付失败率 > 2%
  - [ ] JS 错误率 > 0.3%
  
- [ ] **灰度策略**
  - [ ] 初始 10% 灰度
  - [ ] 观察 24 小时无异常
  - [ ] 逐步放量至 100%

---

## ⚠️ 风险项与预案

| 风险 | 等级 | 触发信号 | 预案 |
|-----|------|---------|------|
| 微信支付未开通 | 🔥 P0 | 11/25 商户号未审核通过 | 延期上线支付；保留"自提不支付"演示流 + Mock 支付回调 |
| 算价 preview 延期 | P1 | 11/23 不可用/错误率高 | 前端先用假数据联通 UI；接口就绪后切换 |
| 地图 Key 额度限制 | P2 | 选点报错/限额 | 临时切文本地址输入；外卖下单禁用，保留自提 |
| 10 天工期不足 | P2 | 11/27 结算未完 | 砍掉优惠券 & 集点仅展示，仅保留基础点单+支付 |
| 包体超限 (>2MB) | P2 | 打包超限 | 分包、按需引入、图片瘦身 (WebP、w=200/600) |

---

## 📈 进度追踪

| 日期 | 计划任务 | 实际完成 | 阻塞项 | 备注 |
|------|---------|---------|-------|------|
| 11.20 | 项目启动 | ✅ | - | Git 仓初始化完成 |
| 11.21 | 基建搭建 | ✅ | - | 网络层/状态管理/组件库已完成 |
| 11.22-11.23 | 基建完善 | ✅ | - | 环境配置/埋点/类型修复全部完成 |
| 11.24-11.25 | 菜单页/规格弹层 | ✅ | - | 菜单左右联动、规格选择、加入购物车全部完成 |
| 11.25 (今日) | 结算页开发 | ⏳ 进行中 | - | 需开始结算页开发 |
| 11.26-11.27 | 结算页完善 | ⏳ 待开始 | - | 地址选择/算价/优惠券 |
| 11.28-11.29 | 订单管理完善 | ⏳ 待开始 | - | 订单列表/详情页优化 |
| 11.30-12.01 | 个人中心 | ⏳ 待开始 | - | 用户信息/集点卡 |
| 12.02-12.03 | 支付联调 | ⏳ 待开始 | 支付商户号 | - |
| 12.04-12.05 | 测试与优化 | ⏳ 待开始 | - | 真机测试/性能优化 |

---

## 📝 开发规范提醒

- **Git 提交**: 遵循 Conventional Commits (`feat:`, `fix:`, `chore:`)
- **代码风格**: ESLint + Prettier 自动格式化
- **命名规范**: 
  - 组件: PascalCase (`ProductCard`)
  - 文件: kebab-case (`product-card.tsx`)
  - 变量/函数: camelCase (`getMenuData`)
- **注释**: 关键逻辑必须注释
- **类型**: 优先使用 TypeScript 类型，避免 `any`
- **性能**: 避免不必要的 re-render，善用 `memo`/`useMemo`

---

## 🎯 每日站会三问

1. **昨天完成了什么?**
2. **今天计划做什么?**
3. **有什么阻塞项?**

---

**最后更新**: 2025.11.25
**负责人**: 开发团队
**审核人**: 小菊 (PM)

---

## 📝 进度总结

### M1 基建完成 (2025.11.20 - 2025.11.25) ✅

**项目基础**: 原生微信小程序 + TypeScript + MobX + TDesign

### ✅ 已完成的基建工作

#### 1. 网络层 (100%)
- ✅ `miniprogram/utils/request.ts` - 完整的请求封装,支持 token 注入、幂等键、错误处理
- ✅ `miniprogram/config/index.ts` - 三环境配置 (dev/staging/prod)
- ✅ 支持运行时切换环境

#### 2. 状态管理 (100%)
- ✅ MobX 6.x 已安装并配置 (mobx-miniprogram + mobx-miniprogram-bindings)
- ✅ `miniprogram/stores/index.ts` - 用户认证状态 (token/userInfo)
- ✅ `miniprogram/stores/shopStore.ts` - 商家数据缓存 (营业状态/菜单)
- ✅ `miniprogram/stores/cartStore.ts` - 游客/用户双模式购物车 (规格去重 + 持久化 + 登录合并)
- ✅ `miniprogram/stores/menuStore.ts` - 菜单数据缓存

#### 3. UI 组件库 (100%)
- ✅ TDesign 1.11.0 已安装
- ✅ npm 构建已配置
- ✅ 主题变量已定义 (支持适老化主题)
- ✅ `miniprogram/components/product-card/` - 商品卡片组件
- ✅ `miniprogram/components/navigation-bar/` - 自定义导航栏
- ✅ `miniprogram/custom-tab-bar/` - 自定义 TabBar

#### 4. 游客模式 (100%)
- ✅ 游客购物车独立存储
- ✅ 用户登录后自动合并游客购物车
- ✅ 相同商品规格累加数量策略
- ✅ 延迟登录策略 - 仅在结算/支付时要求登录

#### 5. 类型定义 (100%)
- ✅ `typings/index.d.ts` - 全局类型定义
- ✅ TypeScript 编译配置完成 (`tsconfig.json`)
- ✅ 微信小程序 API 类型支持

#### 6. 页面结构 (100%)
- ✅ 首页/菜单页/订单列表/个人中心基础页面已创建
- ✅ 自定义导航栏支持
- ✅ 自定义 TabBar 支持

### 🎯 验收标准达成情况

| 验收项 | 状态 | 说明 |
|-------|------|------|
| 网络层可用 | ✅ | request.ts 支持所有必需功能 |
| 状态管理可用 | ✅ | 三个 store 全部实现并持久化 |
| lint 通过 | ✅ | TypeScript/ESLint 无错误 |
| 基础埋点可用 | ⚠️ | 框架已就绪,等待后端接口 |
| 环境切换正常 | ✅ | 支持 dev/staging/prod 运行时切换 |

### 📚 相关文档

- `docs/task-completion-report.md` - 三个立即任务完成报告
- `docs/analytics-endpoint-issue.md` - 埋点接口问题说明
- `docs/env-analytics-fix.md` - 环境配置与埋点机制修复
- `docs/auth-flow-example.md` - **登录流程优化示例（2025.11.24 新增）**
- `docs/01-prd.md` - 产品需求文档（已更新登录策略）

### M2 业务开发进度 (2025.11.25 - 当前) ⏳ 50%

**已完成**：
1. ~~登录与授权~~ ✅ (11.21-11.24 已完成，包含延迟登录优化)
2. ~~菜单页开发~~ ✅ (11.22-11.25 已完成)
   - 左右联动布局
   - 分类切换与商品展示
   - 下拉刷新
   - 店铺详情弹窗
   - 购物车底部栏
3. ~~规格弹层~~ ✅ (11.22-11.25 已完成)
   - 完整规格选择流程
   - 智能默认规格
   - 热饮/冰饮处理
   - 加料限制 (最多2种)
   - 实时价格计算
   - 加入购物车/立即购买

**进行中**：
4. 结算页开发 (11.25-11.27) ⏳
   - [ ] 创建结算页面
   - [ ] 登录检查 (requireLogin)
   - [ ] 地址选择功能
   - [ ] 配送范围校验
   - [ ] 算价 (preview) 对接
   - [ ] 优惠券选择
   - [ ] 集点进度展示

**待开始**：
5. 购物车页面完善 (11.26-11.27)
6. 订单管理完善 (11.28-11.29)
7. 个人中心完善 (11.30-12.01)

### 🎯 当前优先级 (2025.11.25)

**P0 任务**：
1. 创建结算页面基础结构
2. 实现登录检查逻辑
3. 地址选择功能 (wx.chooseLocation)
4. 对接 `POST /orders/preview` 算价接口

**阻塞项**：
- 后端算价接口 (`/orders/preview`) 状态待确认
- 支付商户号申请进度 (Owner: 小菊)
